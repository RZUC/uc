/** * *************************************************** * Copyright (C), NingBo ZhiWeiReach info. Co., Ltd. * ***************************************************** *  * */package com.uc.system.dao.impl;import java.util.List;import javax.annotation.Resource;import org.springframework.data.domain.Sort;import org.springframework.data.domain.Sort.Direction;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import org.springframework.data.mongodb.core.query.TextCriteria;import org.springframework.data.mongodb.core.query.Update;import org.springframework.stereotype.Component;import com.uc.system.dao.PolicyInfoDao;import com.uc.system.exception.ZhiWeiException;import com.uc.system.model.Page;import com.uc.system.model.PolicyInfo;import com.uc.system.util.Sequence;/** * @Description: 政策信息Dao * @ClassName: PolicyInfoDaoImpl * @author 落花流水 * @date 2016年4月27日 上午7:25:21 */@Componentpublic class PolicyInfoDaoImpl extends GeneralDaoImpl implements PolicyInfoDao {	@Resource	private MongoTemplate mongoTemp;	@Override	public PolicyInfo insert(PolicyInfo ob) throws ZhiWeiException {		ob.setId(Integer.valueOf(Sequence.getNextId("policyInfo")));		mongoTemp.save(ob);		return ob;	}	@Override	public PolicyInfo findOne(String id) throws ZhiWeiException {		PolicyInfo info = mongoTemp.findOne(				new Query(Criteria.where("_id").is(Integer.valueOf(id))),				PolicyInfo.class);		return info;	}	@Override	public boolean removeOneById(String id) throws ZhiWeiException {		mongoTemp.remove(new Query(Criteria.where("_id")				.is(Integer.valueOf(id))), PolicyInfo.class);		return false;	}	@Override	public boolean findAndModify(PolicyInfo ob) throws ZhiWeiException {		try {			/**			 * 1.标题			 * 2.来源			 * 3.发布部门			 * 4.类型			 * 5，所在的省市区			 * 6,技术领域			 */			mongoTemp.save(ob);			return true;		} catch (Exception e) {			throw new ZhiWeiException(e.getMessage());		}	}	@Override	public void modifyTop(String id, int toState) {		Query query = new Query(Criteria.where("_id").is(Integer.valueOf(id)));		Update update = new Update();		update.set("topState", toState);		mongoTemp.findAndModify(query, update, PolicyInfo.class);	}	@Override	public List<PolicyInfo> findAll(com.uc.system.model.Query query, Page page) {		// TODO:关键词查找可以用Solr		Query query1 = new Query();		// query.addCriteria(Criteria.where("").is(query.get))		List<PolicyInfo> list = mongoTemp.find(query1, PolicyInfo.class);		return list;	}	@Override	public PolicyInfo findOne(PolicyInfo ob) throws ZhiWeiException {		return null;	}	@Override	public List<PolicyInfo> findAll() throws ZhiWeiException {		return null;	}	@Override	public long findCont() throws ZhiWeiException {		return 0;	}	@Override	public boolean removeAll() throws ZhiWeiException {		return false;	}	@Override	public List<PolicyInfo> findAllByTITLE() {		Query query = new Query();		query.addCriteria(TextCriteria.forDefaultLanguage().matching("政策"));		List<PolicyInfo> list = mongoTemp.find(query, PolicyInfo.class);		return list;	}	@Override	public List<PolicyInfo> findAllByIds(List<String> ids) {		return null;	}	@Override	public List<PolicyInfo> findByType(int type, Page page) {		if (page == null) {			page = new Page();			page.setPageNum(1);			page.setPageSize(10);		}		int skip = (page.getPageNum() - 1) * page.getPageSize();		Query query = null;		if (type == 0) {			query = new Query(Criteria.where("topState").is(1));		} else {			query = new Query(Criteria.where("policyType").is(type));		}		query.limit(page.getPageSize());		query.skip(skip);		query.with(new Sort(Direction.DESC, "releaseTime"));		query.getSortObject().put("releaseTime", -1);		List<PolicyInfo> list = mongoTemp.find(query, PolicyInfo.class);		return list;	}	@Override	public List<PolicyInfo> findTop(int top) {		Query query = new Query(Criteria.where("topState").is(1));//		query.with(new Sort(Direction.DESC, "releaseTime"));		query.limit(top);		List<PolicyInfo> list = mongoTemp.find(query, PolicyInfo.class);		return list;	}	@Override	public int getTotalCount(int type, Page page) {		Query query = null;		if (type == 0) {			query = new Query(Criteria.where("topState").is(1));		} else {			query = new Query(Criteria.where("policyType").is(type));		}		query.with(new Sort(Direction.DESC, "releaseTime"));		query.getSortObject().put("releaseTime", -1);		int totalCount = (int) mongoTemp.count(query, PolicyInfo.class);		return totalCount;	}}